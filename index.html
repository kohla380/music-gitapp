<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á€€á€»á€±á€¬á€„á€ºá€¸á€á€¬á€¸á€•á€Šá€¬á€•á€±á€¸ Portal</title>
    <style>
        :root {
            --bg-image: url('https://images.unsplash.com/photo-1464822759023-fed622ff2c3b');
            --primary: #6a11cb;
            --accent: #3498db;
        }

        body { font-family: 'Pyidaungsu', sans-serif; display: flex; margin: 0; background-image: var(--bg-image); background-size: cover; background-attachment: fixed; min-height: 100vh; flex-direction: column; }
        
        @media (min-width: 768px) { body { flex-direction: row; } }

        .sidebar { width: 100%; background: rgba(44, 62, 80, 0.95); backdrop-filter: blur(10px); color: white; padding: 15px; position: sticky; top: 0; z-index: 100; }
        @media (min-width: 768px) { .sidebar { width: 250px; height: 100vh; } }

        .menu-item { padding: 12px; margin: 5px 0; border-radius: 8px; cursor: pointer; transition: 0.3s; display: inline-block; font-size: 14px; }
        @media (min-width: 768px) { .menu-item { display: block; font-size: 16px; } }
        .menu-item:hover { background: var(--accent); }
        .menu-active { background: var(--accent); font-weight: bold; }

        .main { flex: 1; padding: 20px; text-align: center; }
        .main h1 { color: white; text-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        #content-display { max-width: 800px; margin: 20px auto; }
        
        .post-card { background: white; border-radius: 15px; margin-bottom: 25px; text-align: left; box-shadow: 0 10px 20px rgba(0,0,0,0.2); overflow: hidden; position: relative; }
        
        .fab { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: #2ecc71; color: white; border-radius: 50%; font-size: 30px; border: none; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 1001; }
        #upload-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 25px; border-radius: 15px; z-index: 2000; width: 90%; max-width: 450px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1999; }
        
        select, input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn-submit { background: #2ecc71; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        audio { width: 100%; margin-top: 10px; }
        .delete-btn { background: none; border: none; color: #ff4757; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>Menu</h2>
        <div id="m-all" class="menu-item menu-active" onclick="handleFilter('all', 'm-all')">ğŸ  á€¡á€¬á€¸á€œá€¯á€¶á€¸</div>
        <div id="m-audio" class="menu-item" onclick="handleFilter('audio', 'm-audio')">ğŸµ á€á€®á€á€»á€„á€ºá€¸á€”á€¾á€„á€·á€º á€á€›á€¬á€¸</div>
        <div id="m-study" class="menu-item" onclick="handleFilter('study', 'm-study')">ğŸ“˜ á€…á€¬á€€á€»á€€á€ºá€”á€Šá€ºá€¸á€™á€»á€¬á€¸</div>
    </div>

    <div class="main">
        <h1 id="category-title">ğŸ  á€¡á€¬á€¸á€œá€¯á€¶á€¸</h1>
        <div id="content-display">Loading...</div>
    </div>

    <button class="fab" onclick="showModal()">+</button>
    <div id="overlay" onclick="hideModal()"></div>
    <div id="upload-modal">
        <h3>á€¡á€€á€¼á€±á€¬á€„á€ºá€¸á€¡á€›á€¬á€á€…á€ºá€á€„á€ºá€›á€”á€º</h3>
        <select id="postCategory">
            <option value="audio">ğŸµ á€á€®á€á€»á€„á€ºá€¸á€”á€¾á€„á€·á€º á€á€›á€¬á€¸</option>
            <option value="study">ğŸ“˜ á€…á€¬á€€á€»á€€á€ºá€”á€Šá€ºá€¸á€™á€»á€¬á€¸</option>
        </select>
        <input type="text" id="postTitle" placeholder="á€á€±á€«á€„á€ºá€¸á€…á€‰á€º">
        <textarea id="postContent" rows="3" placeholder="á€¡á€€á€¼á€±á€¬á€„á€ºá€¸á€¡á€›á€¬"></textarea>
        <input type="text" id="audioUrlInput" placeholder="GitHub á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º Drive Link">
        <button class="btn-submit" onclick="saveToFirebase()">á€á€„á€ºá€™á€Šá€º</button>
        <button onclick="hideModal()" style="width:100%; margin-top:10px; background:#eee; border:none; padding:10px; border-radius:8px;">á€•á€­á€á€ºá€•á€«</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, query, orderBy, onSnapshot, where, Timestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // á€•á€¼á€„á€ºá€†á€„á€ºá€•á€¼á€®á€¸á€á€¬á€¸ Config (apiKey á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€‘á€¬á€¸á€á€Šá€º)
        const firebaseConfig = {
            apiKey: "AIzaSyC4c2aE6LOMjf00e_SPIB7snz8MbYy37_g",
            authDomain: "cherry-project-08.firebaseapp.com",
            projectId: "cherry-project-08",
            storageBucket: "cherry-project-08.appspot.com",
            appId: "1:600023073662:web:8c60662b02f7dbac13692f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let unsubscribe = null;

        // Global scope functions
        window.showModal = () => { document.getElementById('upload-modal').style.display='block'; document.getElementById('overlay').style.display='block'; }
        window.hideModal = () => { document.getElementById('upload-modal').style.display='none'; document.getElementById('overlay').style.display='none'; }

        window.handleFilter = (cat, elId) => {
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('menu-active'));
            document.getElementById(elId).classList.add('menu-active');
            document.getElementById('category-title').innerText = document.getElementById(elId).innerText;
            loadContent(cat);
        };

        window.saveToFirebase = async () => {
            const title = document.getElementById('postTitle').value;
            const text = document.getElementById('postContent').value;
            let link = document.getElementById('audioUrlInput').value;
            const cat = document.getElementById('postCategory').value;

            if (link.includes("drive.google.com")) {
                const match = link.match(/\/d\/([a-zA-Z0-9_-]+)/);
                if (match) link = `https://drive.google.com/uc?export=media&id=${match[1]}`;
            }

            if(title && text) {
                try {
                    await addDoc(collection(db, "portal_content"), {
                        category: cat, title, content: text, audioUrl: link, date: Timestamp.now()
                    });
                    hideModal();
                    document.getElementById('postTitle').value = "";
                    document.getElementById('postContent').value = "";
                    document.getElementById('audioUrlInput').value = "";
                } catch(e) { alert("Error: " + e.message); }
            } else { alert("á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€•á€¼á€Šá€·á€ºá€…á€¯á€¶á€¡á€±á€¬á€„á€º á€–á€¼á€Šá€·á€ºá€•á€«"); }
        };

        window.loadContent = (filterCategory = 'all') => {
            if (unsubscribe) unsubscribe();
            let q = query(collection(db, "portal_content"), orderBy("date", "desc"));
            if (filterCategory !== 'all') {
                q = query(collection(db, "portal_content"), where("category", "==", filterCategory), orderBy("date", "desc"));
            }

            unsubscribe = onSnapshot(q, (snapshot) => {
                const display = document.getElementById('content-display');
                display.innerHTML = "";
                snapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    display.innerHTML += `
                        <div class="post-card">
                            <div style="padding:20px;">
                                <div style="display:flex; justify-content:space-between;">
                                    <small>#${data.category}</small>
                                    <button class="delete-btn" onclick="deletePost('${docSnap.id}')">á€–á€»á€€á€ºá€›á€”á€º</button>
                                </div>
                                <h2>${data.title}</h2>
                                <p style="white-space: pre-wrap;">${data.content}</p>
                                ${data.audioUrl ? `<audio controls src="${data.audioUrl}"></audio>` : ''}
                            </div>
                        </div>`;
                });
            });
        };

        window.deletePost = async (id) => { if(confirm("á€–á€»á€€á€ºá€™á€¾á€¬á€œá€¬á€¸?")) await deleteDoc(doc(db, "portal_content", id)); };

        loadContent();
    </script>
</body>
</html>
